<div class="container">
    <igx-hierarchical-grid #grid [data]="properties | async" width="100%" height="600px" [rowEditable]="true"
        [primaryKey]="'id'" (rowAdded)="propertyAdded($event)" (rowEditDone)="propertyEdited($event)"
        (rowDeleted)="propertyDeleted($event)">
        <igx-column field="type" [sortable]="true">
            <ng-template igxCell let-cell="cell">
                {{ parseType(cell.value) }}
            </ng-template>
            <ng-template igxCellEditor let-cell="cell">
                <igx-select type="border" [(ngModel)]="cell.editValue"
                    style="height: max-content; min-width: min-content;">
                    <igx-select-item [value]="type.value" *ngFor="let type of types">
                        {{type.name}}
                    </igx-select-item>
                </igx-select>
            </ng-template>
        </igx-column>
        <igx-column field="number" [sortable]="true"></igx-column>
        <igx-column field="share" dataType="number" [sortable]="true"></igx-column>

        <igx-action-strip>
            <igx-grid-editing-actions [addRow]="true"></igx-grid-editing-actions>
        </igx-action-strip>

        <igx-row-island #personRowIsland [key]="'people'" [primaryKey]="'id'" [rowEditable]="true">
            <igx-column field="person">
                <ng-template igxCell let-cell="cell">
                    {{ cell.value?.name ?? '' }}
                </ng-template>
                <ng-template igxCellEditor let-cell="cell">
                    <igx-select type="border" [(ngModel)]="cell.editValue"
                        style="height: max-content; min-width: min-content;">
                        <igx-select-item [value]="cell.editValue?.id == person.id ? cell.editValue : person" *ngFor="let person of people | async">
                            {{person.name}}
                        </igx-select-item>
                    </igx-select>
                </ng-template>
            </igx-column>
            <igx-column field="type">
                <ng-template igxCell let-cell="cell">
                    {{ parsePersonType(cell.value) }}
                </ng-template>
                <ng-template igxCellEditor let-cell="cell">
                    <igx-select type="border" [(ngModel)]="cell.editValue"
                        style="height: max-content; min-width: min-content;">
                        <igx-select-item [value]="personType.value" *ngFor="let personType of personTypes">
                            {{personType.name}}
                        </igx-select-item>
                    </igx-select>
                </ng-template>
            </igx-column>
            <igx-column field="residence">
                <ng-template igxCell let-cell="cell">
                    {{ parseResidence(cell.value) }}
                </ng-template>
                <ng-template igxCellEditor let-cell="cell">
                    <igx-select type="border" [(ngModel)]="cell.editValue"
                        style="height: max-content; min-width: min-content;">
                        <igx-select-item [value]="residence.value" *ngFor="let residence of residencies">
                            {{residence.name}}
                        </igx-select-item>
                    </igx-select>
                </ng-template>
            </igx-column>
            <igx-column field="monthsInHouse" dataType="number"></igx-column>
            <igx-column field="registeredOn" dataType="date"></igx-column>
            <igx-column field="unRegisteredOn" dataType="date"></igx-column>

            <igx-action-strip>
                <igx-grid-editing-actions [addRow]="true"></igx-grid-editing-actions>
            </igx-action-strip>
        </igx-row-island>

        <igx-row-island #carRowIsland [key]="'cars'" [primaryKey]="'id'" [rowEditable]="true">
            <igx-column field="number">
                <ng-template igxCellEditor let-cell="cell">
                    <igx-select type="border" [(ngModel)]="cell.editValue"
                        style="height: max-content; min-width: min-content;">
                        <igx-select-item [value]="car.number" *ngFor="let car of cars | async">
                            {{car.number}}
                        </igx-select-item>
                    </igx-select>
                </ng-template>
            </igx-column>

            <igx-action-strip>
                <igx-grid-editing-actions [addRow]="true"></igx-grid-editing-actions>
            </igx-action-strip>
        </igx-row-island>

        <igx-row-island #petRowIsland [key]="'pets'" [primaryKey]="'id'" [rowEditable]="true">
            <igx-column field="number">
                <ng-template igxCellEditor let-cell="cell">
                    <igx-select type="border" [(ngModel)]="cell.editValue"
                        style="height: max-content; min-width: min-content;">
                        <igx-select-item [value]="pet.number" *ngFor="let pet of pets | async">
                            {{pet.number}} - {{pet.name}}
                        </igx-select-item>
                    </igx-select>
                </ng-template>
            </igx-column>

            <igx-action-strip>
                <igx-grid-editing-actions [addRow]="true"></igx-grid-editing-actions>
            </igx-action-strip>
        </igx-row-island>

    </igx-hierarchical-grid>
</div>